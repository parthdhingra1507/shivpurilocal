<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shivpuri News - Latest Updates | Shivpuri Local</title>
<meta name="description"
    content="Get the latest news and updates from Shivpuri, Madhya Pradesh. Stay informed about local events, developments, and happenings.">
<link rel="canonical" href="https://shivpurilocal.in/news">

<!-- Open Graph / WhatsApp -->
<meta property="og:title" content="Shivpuri News - Latest Updates">
<meta property="og:description" content="Stay updated with latest news from Shivpuri, MP.">
<meta property="og:image" content="https://shivpurilocal.in/social-preview.png">
<meta property="og:type" content="website">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6F0WC51BKD"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-6F0WC51BKD');
</script>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3448/3448339.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Shivpuri Local">
<link rel="stylesheet" href="style.css?v=1.1">
<script src="sw-register.js?v=1.1"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<body class="page-news">
    <div class="app-container">
        <header class="main-header">
            <div class="logo-container">
                <a href="/" style="text-decoration: none; color: inherit;">
                    <h1 class="logo">Shivpuri<span class="highlight">Local</span></h1>
                </a>
                <p class="tagline">The City Encyclopedia</p>
            </div>
            <div class="header-actions" style="display: flex; gap: 0.5rem; align-items: center;">
                <button id="install-btn" class="install-btn" style="display: none;">‚¨áÔ∏è App</button>
                <button id="lang-toggle" class="lang-btn">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/transport">Transport</a></li>
                    <li><a href="/places">Places</a></li>
                    <li><a href="/food">Food</a></li>
                    <li><a href="/news" class="active">News</a></li>
                </ul>
            </nav>
        </header>

        <main class="content-area">
            <section class="hero">
                <h2 id="hero-title">üì∞ City News</h2>
                <p id="hero-desc">Latest headlines from Shivpuri & Madhya Pradesh</p>
            </section>

            <section class="news-container">
                <div id="news-grid" class="news-grid">
                    <!-- News cards will be populated here -->
                    <div class="news-loading">
                        <p>üîÑ Connecting to News Server...</p>
                        <p style="font-size:0.8rem; color:#666;">(This may take 30s on first load)</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Article Modal -->
        <div id="article-modal" class="article-modal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeArticleModal()">&times;</button>
                <div class="modal-header">
                    <span id="modal-source" class="modal-source"></span>
                    <span id="modal-time" class="modal-time"></span>
                </div>
                <h2 id="modal-title" class="modal-title"></h2>
                <p id="modal-desc" class="modal-desc"></p>
                <div class="modal-actions">
                    <a id="modal-share" href="#" target="_blank" rel="noopener" class="news-share-btn modal-share-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z" />
                        </svg>
                        Share on WhatsApp
                    </a>
                </div>
            </div>
        </div>

        <footer class="main-footer">
            <p>&copy; 2025 shivpurilocal.in. All rights reserved.</p>
            <div class="footer-links">
                <a href="https://wa.me/917880045440?text=Hi%2C%20I%20want%20to%20list%20my%20business%20on%20shivpurilocal.in"
                    target="_blank" class="footer-link">List Your Business</a>
                <a href="https://wa.me/917880045440?text=Hi%2C%20I%20have%20feedback%20about%20shivpurilocal.in"
                    target="_blank" class="footer-link">Send Feedback</a>
            </div>
        </footer>
    </div>

    <script src="common.js?v=1.1"></script>
    <script src="script.js?v=1.1"></script>
    <script>
        const isNewsPage = true;

        // GNews API Configuration - Using 3 queries for more articles
        const GNEWS_API_KEY = 'c0f5d443f40740ce824fd1ee3e3b3ed8';
        const NEWS_QUERIES = [
            'India OR Madhya Pradesh OR Shivpuri',
            'MP news OR Gwalior OR Bhopal',
            'breaking news India latest'
        ];
        const NEWS_REFRESH_INTERVAL = 30 * 60 * 1000; // 30 minutes as requested

        let currentNewsData = [];
        let lastFetchTime = null;

        // Cache configuration
        const NEWS_CACHE_KEY = 'shivpuri_news_cache';
        const NEWS_CACHE_VERSION = 'v4-multi'; // Updated for multi-query
        const NEWS_CACHE_EXPIRY = 30 * 60 * 1000; // 30 minutes

        // Load cached news
        function loadCachedNews() {
            try {
                const cached = localStorage.getItem(NEWS_CACHE_KEY);
                if (cached) {
                    const { data, timestamp, version } = JSON.parse(cached);
                    const age = Date.now() - timestamp;
                    if (age < NEWS_CACHE_EXPIRY && data.length > 0 && version === NEWS_CACHE_VERSION) {
                        console.log('üì¶ Loading cached news');
                        return data;
                    } else if (version !== NEWS_CACHE_VERSION) {
                        console.log('üîÑ Cache version outdated, fetching new news');
                    }
                }
            } catch (e) {
                console.log('Cache read error:', e);
            }
            return null;
        }

        // Save news to cache
        function saveNewsToCache(data) {
            try {
                localStorage.setItem(NEWS_CACHE_KEY, JSON.stringify({
                    data: data,
                    timestamp: Date.now(),
                    version: NEWS_CACHE_VERSION
                }));
                console.log('üíæ News cached');
            } catch (e) {
                console.log('Cache write error:', e);
            }
        }

        // Calculate relative time
        function getRelativeTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);

            const isHi = currentLang === 'hi';

            if (diffMins < 60) {
                return isHi ? `${diffMins} ‡§Æ‡§ø‡§®‡§ü ‡§™‡§π‡§≤‡•á` : `${diffMins} minutes ago`;
            } else if (diffHours < 24) {
                return isHi ? `${diffHours} ‡§ò‡§Ç‡§ü‡•á ‡§™‡§π‡§≤‡•á` : `${diffHours} hours ago`;
            } else {
                return isHi ? `${diffDays} ‡§¶‡§ø‡§® ‡§™‡§π‡§≤‡•á` : `${diffDays} days ago`;
            }
        }

        // Deduplicate by title
        function deduplicateNews(articles) {
            const seen = new Set();
            return articles.filter(article => {
                const titleKey = article.title.toLowerCase().trim();
                if (seen.has(titleKey)) return false;
                seen.add(titleKey);
                return true;
            });
        }

        function renderNews() {
            const grid = document.getElementById('news-grid');
            const isHi = currentLang === 'hi';

            grid.innerHTML = '';

            if (currentNewsData.length === 0) {
                const noNewsText = isHi ? '‡§ï‡•ã‡§à ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ' : 'No news found';
                grid.innerHTML = `<div class="news-loading"><p>üì∞ ${noNewsText}</p></div>`;
                return;
            }

            currentNewsData.forEach(news => {
                const card = document.createElement('div');
                card.className = 'news-card';

                // title_en/description_en were removed from fetcher, now language is handled at source
                const title = news.title;
                const desc = news.description;

                const time = news.publishedAt ? getRelativeTime(news.publishedAt) : '';
                const readMore = isHi ? '‡§Æ‡•Ç‡§≤ ‡§ñ‡§¨‡§∞ ‡§™‡§¢‡§º‡•á‡§Ç' : 'Read Full Story'; // clearer label
                const shareText = isHi ? '‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç' : 'Share';

                // WhatsApp share URL
                const whatsappText = `üì∞ *${title}*\n\n${desc}\n\nüîó ${news.url}\n\nvia shivpurilocal.in`;
                const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(whatsappText)}`;

                card.innerHTML = `
                    <div class="news-body" style="height: 100%; display: flex; flex-direction: column;">
                        <div>
                            <div class="news-meta">
                                <span class="news-source">${news.source}</span>
                                <span class="news-source-row" style="float: right; margin: 0;">
                                    <span class="news-time" style="font-weight: 500; font-size: 0.75rem;">${time}</span>
                                </span>
                            </div>
                            <h3 class="news-title">${title}</h3>
                        </div>
                        
                        <div class="card-actions" style="margin-top: auto;">
                            <a href="${whatsappUrl}" target="_blank" rel="noopener" class="share-btn">Share</a>
                            <a href="${news.url}" target="_blank" rel="noopener" class="map-btn" style="margin-left: auto;">${readMore} ‚Üó</a>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            // Add last updated indicator
            if (lastFetchTime) {
                const updateInfo = document.createElement('div');
                updateInfo.className = 'news-update-info';
                const updateText = isHi ?
                    `‡§Ü‡§ñ‡§ø‡§∞‡•Ä ‡§Ö‡§™‡§°‡•á‡§ü: ${lastFetchTime.toLocaleTimeString('hi-IN')}` :
                    `Last updated: ${lastFetchTime.toLocaleTimeString('en-IN')}`;
                updateInfo.innerHTML = `<p>üîÑ ${updateText}</p>`;
                grid.appendChild(updateInfo);
            }
        }

        // Update language function
        function updatePageLanguage(lang) {
            const heroTitle = document.getElementById('hero-title');
            const heroDesc = document.getElementById('hero-desc');

            if (heroTitle) heroTitle.textContent = lang === 'hi' ? 'üì∞ ‡§∂‡§π‡§∞ ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞' : 'üì∞ City News';
            if (heroDesc) heroDesc.textContent = lang === 'hi' ? '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä ‡§î‡§∞ ‡§Æ‡§ß‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡•á‡§∂ ‡§ï‡•Ä ‡§§‡§æ‡§ú‡§º‡§æ ‡§ñ‡§¨‡§∞‡•á‡§Ç' : 'Latest headlines from Shivpuri & Madhya Pradesh';

            renderNews();
        }

        // Initialize
        let renderedTitles = new Set(); // Track rendered articles to avoid duplicates
        let isFirstLoad = true;

        // Multi-Source RSS Configuration
        const RSS_TO_JSON_API = 'https://api.rss2json.com/v1/api.json?rss_url=';

        const FEEDS = {
            en: [
                // PRIORITY 1: Shivpuri - Multiple search variations to guarantee content
                { url: 'https://news.google.com/rss/search?q=Shivpuri&hl=en-IN&gl=IN&ceid=IN:en', name: 'Shivpuri', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=Shivpuri+MP&hl=en-IN&gl=IN&ceid=IN:en', name: 'Shivpuri', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=Shivpuri+news&hl=en-IN&gl=IN&ceid=IN:en', name: 'Shivpuri', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=Shivpuri+police&hl=en-IN&gl=IN&ceid=IN:en', name: 'Shivpuri', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=Shivpuri+accident&hl=en-IN&gl=IN&ceid=IN:en', name: 'Shivpuri', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=Shivpuri+crime&hl=en-IN&gl=IN&ceid=IN:en', name: 'Shivpuri', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=Shivpuri+collector&hl=en-IN&gl=IN&ceid=IN:en', name: 'Shivpuri', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=Shivpuri+hospital&hl=en-IN&gl=IN&ceid=IN:en', name: 'Shivpuri', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=site:jagran.com+Shivpuri&hl=en-IN&gl=IN&ceid=IN:en', name: 'Shivpuri', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=site:bhaskar.com+Shivpuri&hl=en-IN&gl=IN&ceid=IN:en', name: 'Shivpuri', priority: 1 },

                // PRIORITY 2: Nearby Cities
                { url: 'https://news.google.com/rss/search?q=Gwalior&hl=en-IN&gl=IN&ceid=IN:en', name: 'Gwalior', priority: 2 },
                { url: 'https://news.google.com/rss/search?q=Bhopal&hl=en-IN&gl=IN&ceid=IN:en', name: 'Bhopal', priority: 2 },

                // PRIORITY 3: MP State
                { url: 'https://news.google.com/rss/search?q=Madhya+Pradesh&hl=en-IN&gl=IN&ceid=IN:en', name: 'MP', priority: 3 },
                { url: 'https://timesofindia.indiatimes.com/rssfeeds/2965003.cms', name: 'MP', priority: 3 }
            ],
            hi: [
                // PRIORITY 1: ‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä - Multiple variations
                { url: 'https://news.google.com/rss/search?q=%E0%A4%B6%E0%A4%BF%E0%A4%B5%E0%A4%AA%E0%A5%81%E0%A4%B0%E0%A5%80&hl=hi&gl=IN&ceid=IN:hi', name: '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=Shivpuri&hl=hi&gl=IN&ceid=IN:hi', name: '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=%E0%A4%B6%E0%A4%BF%E0%A4%B5%E0%A4%AA%E0%A5%81%E0%A4%B0%E0%A5%80+%E0%A4%B8%E0%A4%AE%E0%A4%BE%E0%A4%9A%E0%A4%BE%E0%A4%B0&hl=hi&gl=IN&ceid=IN:hi', name: '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=%E0%A4%B6%E0%A4%BF%E0%A4%B5%E0%A4%AA%E0%A5%81%E0%A4%B0%E0%A5%80+%E0%A4%AA%E0%A5%81%E0%A4%B2%E0%A4%BF%E0%A4%B8&hl=hi&gl=IN&ceid=IN:hi', name: '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=%E0%A4%B6%E0%A4%BF%E0%A4%B5%E0%A4%AA%E0%A5%81%E0%A4%B0%E0%A5%80+%E0%A4%B9%E0%A4%BE%E0%A4%A6%E0%A4%B8%E0%A4%BE&hl=hi&gl=IN&ceid=IN:hi', name: '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=site:jagran.com+%E0%A4%B6%E0%A4%BF%E0%A4%B5%E0%A4%AA%E0%A5%81%E0%A4%B0%E0%A5%80&hl=hi&gl=IN&ceid=IN:hi', name: '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=site:bhaskar.com+%E0%A4%B6%E0%A4%BF%E0%A4%B5%E0%A4%AA%E0%A5%81%E0%A4%B0%E0%A5%80&hl=hi&gl=IN&ceid=IN:hi', name: '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä', priority: 1 },
                { url: 'https://news.google.com/rss/search?q=site:patrika.com+%E0%A4%B6%E0%A4%BF%E0%A4%B5%E0%A4%AA%E0%A5%81%E0%A4%B0%E0%A5%80&hl=hi&gl=IN&ceid=IN:hi', name: '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä', priority: 1 },

                // PRIORITY 2: Nearby Cities
                { url: 'https://news.google.com/rss/search?q=%E0%A4%97%E0%A5%8D%E0%A4%B5%E0%A4%BE%E0%A4%B2%E0%A4%BF%E0%A4%AF%E0%A4%B0&hl=hi&gl=IN&ceid=IN:hi', name: '‡§ó‡•ç‡§µ‡§æ‡§≤‡§ø‡§Ø‡§∞', priority: 2 },
                { url: 'https://news.google.com/rss/search?q=%E0%A4%AD%E0%A5%8B%E0%A4%AA%E0%A4%BE%E0%A4%B2&hl=hi&gl=IN&ceid=IN:hi', name: '‡§≠‡•ã‡§™‡§æ‡§≤', priority: 2 },

                // PRIORITY 3: MP State
                { url: 'https://news.google.com/rss/search?q=%E0%A4%AE%E0%A4%A7%E0%A5%8D%E0%A4%AF+%E0%A4%AA%E0%A5%8D%E0%A4%B0%E0%A4%A6%E0%A5%87%E0%A4%B6&hl=hi&gl=IN&ceid=IN:hi', name: '‡§Æ‡§ß‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡•á‡§∂', priority: 3 }
            ]
        };

        // FORCE HEADLINE FIX
        setTimeout(() => updatePageLanguage(currentLang), 100);

        window.updatePageLanguage = function (lang) {
            const h2 = document.getElementById('hero-title');
            const p = document.getElementById('hero-desc');
            if (lang === 'hi') {
                if (h2) h2.textContent = 'üì∞ ‡§∂‡§π‡§∞ ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞';
                if (p) p.textContent = '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞‡•Ä ‡§î‡§∞ ‡§Æ‡§ß‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡•á‡§∂ ‡§ï‡•Ä ‡§§‡§æ‡§ú‡§º‡§æ ‡§ñ‡§¨‡§∞‡•á‡§Ç';
            } else {
                if (h2) h2.textContent = 'üì∞ City News';
                if (p) p.textContent = 'Latest headlines from Shivpuri & Madhya Pradesh';
            }
            console.log('Language switch -> fetching news');

            // Clear current grid and cache references on language switch
            document.getElementById('news-grid').innerHTML = '';
            renderedTitles.clear();
            currentNewsData = [];
            fetchNews();
        };

        function isRefreshTime() {
            const hour = new Date().getHours();
            return hour >= 6 && hour <= 23;
        }

        // VIEW ARTICLE
        window.viewArticle = function (index) {
            const article = currentNewsData[index];
            if (article) {
                localStorage.setItem('selectedArticle', JSON.stringify(article));
                window.location.href = 'article.html';
            }
        };

        // Hybrid Fetch: Backend -> Fallback to RSS
        const RSS_PROXY = 'https://api.rss2json.com/v1/api.json?rss_url=';
        const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000/api' : 'https://shivpurilocal-backend.onrender.com/api';

        // Standardize Source Tags
        function normalizeSource(rawSource) {
            const s = rawSource.toLowerCase();
            if (s.includes('google') || s.includes('news')) return 'NEWS UPDATE';
            if (s.includes('shivpuri') || s.includes('mp') || s.includes('local')) return 'CITY NEWS';
            if (s.includes('times') || s.includes('hindu') || s.includes('ndtv')) return 'NATIONAL';
            if (s.includes('patrika') || s.includes('bhaskar')) return 'HINDI NEWS';
            return 'LATEST NEWS';
        }

        async function fetchNews() {
            const grid = document.getElementById('news-grid');
            const isHi = currentLang === 'hi';
            const loadingText = isHi ? 'AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ñ‡§¨‡§∞‡•á‡§Ç ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç...' : 'Loading AI Curated News...';
            grid.innerHTML = `<div class="news-loading"><div class="loading-spinner"></div><p>${loadingText}</p></div>`;

            try {
                // Fetch from Backend (which now uses OpenAI)
                const res = await fetch(`${API_URL}/news?lang=${currentLang}`);

                if (res.ok) {
                    const data = await res.json();
                    if (data && data.length > 0) {
                        console.log(`Loaded ${data.length} articles from Backend (AI Processed)`);
                        currentNewsData = deduplicateNews(data);
                        renderNews();
                        return;
                    }
                }
            } catch (e) {
                console.error('Backend unavailable:', e);
            }

            // If we are here, backend failed. Show friendly error.
            grid.innerHTML = `<div class="error-state">
                <p>‚ö†Ô∏è ${isHi ? '‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§Ø‡§æ' : 'Server Connection Failed'}</p>
                <p style="font-size:0.8rem; color:#666;">Please ensure Backend is running with OpenAI Key</p>
                <button onclick="fetchNews()" style="margin-top:1rem; padding:0.5rem 1rem; border:1px solid #ccc; background:#fff; border-radius:4px;">Retry</button>
            </div>`;
        }




        // Premium News Card Renderer
        function renderBatch(articles) {
            const grid = document.getElementById('news-grid');
            const isHi = currentLang === 'hi';

            articles.forEach((news, index) => {
                const card = document.createElement('article');
                card.className = 'news-card';

                const title = news.title || '';
                // Get description - prefer content, fallback to description
                let rawContent = news.content || news.description || '';
                // Clean HTML tags and extra chars
                let cleanContent = rawContent.replace(/<[^>]*>/g, '').replace(/\[\+\d+ chars\]/g, '').trim();

                // Strict check: valid description must be longer than title and not contain title
                const cleanDesc = cleanContent.toLowerCase().replace(/[^\w\s]/g, '');
                const cleanTitle = title.toLowerCase().replace(/[^\w\s]/g, '');

                const isSame = cleanDesc === cleanTitle;
                const isContained = cleanDesc.includes(cleanTitle) || cleanTitle.includes(cleanDesc);
                const isTooShort = cleanContent.length < 20; // Lower threshold but stricter content check

                // Only show description if it adds value
                const showDescription = !isSame && !isContained && !isTooShort;

                const time = news.publishedAt ? getRelativeTime(news.publishedAt) : '';
                const source = normalizeSource(news.source || '');

                const shareText = isHi ? '‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç' : 'Share';
                const readText = isHi ? '‡§™‡•Ç‡§∞‡•Ä ‡§ñ‡§¨‡§∞ ‡§™‡§¢‡§º‡•á‡§Ç' : 'Read Full Story';

                const whatsappText = `üì∞ *${title}*\n\nüîó ${news.url}\n\nvia shivpurilocal.in`;
                const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(whatsappText)}`;

                // Simple image
                const imageHtml = news.image ? `
                    <div class="news-image-wrapper">
                        <img src="${news.image}" alt="" class="news-image" onerror="this.parentElement.style.display='none'">
                    </div>` : '';

                card.innerHTML = `
                    ${imageHtml}
                    <div class="news-body" style="height: 100%; display: flex; flex-direction: column;">
                        <div>
                            <div class="news-meta">
                                <span class="news-source">${source}</span>
                                <span class="news-source-row" style="float: right; margin: 0;">
                                    <span class="news-time" style="font-weight: 500; font-size: 0.75rem;">${time}</span>
                                </span>
                            </div>
                            <h3 class="news-title">${title}</h3>
                        </div>
                        <div class="card-actions" style="margin-top: auto;">
                            <a href="${whatsappUrl}" target="_blank" rel="noopener" class="share-btn">${shareText}</a>
                            <a href="${news.url}" target="_blank" rel="noopener" class="map-btn" style="margin-left: auto;">${readText} ‚Üó</a>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Auto-refresh every 30 minutes
        setInterval(() => {
            if (isRefreshTime()) {
                renderedTitles.clear();
                document.getElementById('news-grid').innerHTML = '';
                currentNewsData = [];
                fetchNews();
            }
        }, NEWS_REFRESH_INTERVAL);

        // Initial load
        fetchNews();
    </script>
</body>

</html>